# Mini IDP — Preview Environment Configuration
#
# This file configures automatic preview environment provisioning.
# When a branch is pushed, the preview-env workflow reads this file
# to determine what infrastructure to create.
#
# If this file is missing, defaults are used:
#   template: api-service, image: nginx:alpine, port: 80, ttl: 7d

# Required: infrastructure template
# Options: api-service | api-database | scheduled-worker
template: api-service

# Container configuration (api-service and api-database templates)
container_image: nginx:alpine
container_port: 80

# Time-to-live for preview environments.
# Extended automatically on every push to the branch.
ttl: 7d

# Docker build configuration
# If a Dockerfile is found, the image is built, pushed to ECR, and deployed.
# If no Dockerfile exists, container_image above is used as-is.
# dockerfile: Dockerfile       # Path to Dockerfile (default: auto-detect at repo root)
# build_context: .              # Docker build context directory (default: repo root)

# Environment variables injected into the container at launch.
# These are plain-text values suitable for non-sensitive configuration.
environment:
  IDP_APP_NAME: mini-idp-test
  IDP_ENV: preview
  LOG_LEVEL: debug

# Secrets from AWS Secrets Manager injected as container env vars at launch.
# Use the full ARN:json-key::  format (ECS valueFrom syntax).
# The actual secret values never touch Terraform state or workflow logs.
# secrets:
#   API_KEY: "arn:aws:secretsmanager:us-east-1:ACCOUNT:secret:NAME:KEY::"
#
# Note: The api-database template auto-injects DB_HOST, DB_PORT, DB_NAME,
# DB_USER, and DB_PASSWORD — no configuration needed.

# Scheduled task configuration (scheduled-worker template only)
# schedule_expression: "rate(1 hour)"
# s3_bucket_arn: "arn:aws:s3:::my-bucket"
