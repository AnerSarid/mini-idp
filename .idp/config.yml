# Mini IDP — Preview Environment Configuration
#
# This file configures automatic preview environment provisioning.
# When a branch is pushed, the preview-env workflow reads this file
# to determine what infrastructure to create.
#
# If this file is missing, defaults are used:
#   template: api-service, image: nginx:alpine, port: 80, ttl: 7d

# Required: infrastructure template
# Options: api-service | api-database | scheduled-worker
template: api-service

# Container configuration (api-service and api-database templates)
container_image: nginx:alpine
container_port: 80

# Time-to-live for preview environments.
# Extended automatically on every push to the branch.
ttl: 7d

# Resource sizing for the Fargate task.
# cpu: 256, 512, 1024, 2048, or 4096 (default: 256)
# memory: must be valid for the chosen CPU (default: 512)
#   256 CPU  → 512, 1024, 2048
#   512 CPU  → 1024–4096
#   1024 CPU → 2048–8192
#   2048 CPU → 4096–16384
#   4096 CPU → 8192–30720
# cpu: 256
# memory: 512

# CloudWatch log retention in days (default: 3).
# Valid values: 1, 3, 5, 7, 14, 30, 60, 90
# log_retention_days: 3

# Docker build configuration
# If a Dockerfile is found, the image is built, pushed to ECR, and deployed.
# If no Dockerfile exists, container_image above is used as-is.
# dockerfile: Dockerfile       # Path to Dockerfile (default: auto-detect at repo root)
# build_context: .              # Docker build context directory (default: repo root)

# Environment variables injected into the container at launch.
# These are plain-text values suitable for non-sensitive configuration.
# environment:
#   NODE_ENV: preview
#   LOG_LEVEL: debug

# Secrets from AWS Secrets Manager injected as container env vars at launch.
# Use the full ARN:json-key::  format (ECS valueFrom syntax).
# The actual secret values never touch Terraform state or workflow logs.
# secrets:
#   API_KEY: "arn:aws:secretsmanager:us-east-1:ACCOUNT:secret:NAME:KEY::"
#
# Note: The api-database template auto-injects DB_HOST, DB_PORT, DB_NAME,
# DB_USER, and DB_PASSWORD — no configuration needed.

# Scheduled task configuration (scheduled-worker template only)
# schedule_expression: "rate(1 hour)"
# s3_bucket_arn: "arn:aws:s3:::my-bucket"
